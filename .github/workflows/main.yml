name: Deploy Laravel to Hostinger

on: 
  workflow_dispatch: # ‚Üê Enables manual "Run Workflow" button
  # push:
  #   branches: ["main"]

jobs:
  deploy:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Setup PHP
          uses: shivammathur/setup-php@v2
          with:
            php-version: "8.2"
            extensions: mbstring, intl, bcmath, openssl, mysqli, pdo_mysql
            tools: composer

        - name: Install Composer Dependencies
          run: composer install --no-dev --optimize-autoloader

        - name: Prepare Deployment Package
          run: |
            rm -rf .git
            zip -r deploy.zip . -x "vendor/*" ".git/*"

        - name: Copy Files to Hostinger
          uses: appleboy/scp-action@v0.1.7
          with:
            host: ${{ secrets.SSH_HOST }}
            username: ${{ secrets.SSH_USER }}
            port: ${{ secrets.SSH_PORT }}
            key: ${{ secrets.SSH_PRIVATE_KEY }}
            source: "deploy.zip"
            target: ${{ secrets.DEPLOY_PATH }}

  # - name: Run Deploy Commands on Server
  #   uses: appleboy/ssh-action@v1.0.3
  #   with:
  #     host: ${{ secrets.SSH_HOST }}
  #     username: ${{ secrets.SSH_USER }}
  #     port: ${{ secrets.SSH_PORT }}
  #     key: ${{ secrets.SSH_PRIVATE_KEY }}
  #     script: |
  #       cd ${{ secrets.DEPLOY_PATH }}
  #       unzip -o deploy.zip
  #       rm deploy.zip
  #       composer install --no-dev --optimize-autoloader
  #       php artisan migrate --force
  #       php artisan config:clear
  #       php artisan config:cache
  #       php artisan route:cache
  #       php artisan view:cache
